<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>The amazing news summary page</title>
    <script src="https://rawgit.com/rogrenke/testFramework-js/master/helpers.js" type="text/javascript"></script>
    
  <link href="style.css" type="text/css" rel="stylesheet" >
  <script>
    var sentences;
     
    function loadXMLDoc() {
      var xhttp = new XMLHttpRequest();
      var API_KEY = "1eb0ccf89bbb379a3905a8df22bb438a";
      var APP_ID = "36bbd38c";
         
     function textSummarize(url, callback) {
       
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {  
        if (this.readyState == 4 && this.status == 200) {
          callback(JSON.parse(this.responseText).sentences);
        }
        
      };
      
      xhttp.open("GET", "http://news-summary-api.herokuapp.com/aylien?apiRequestUrl=https://api.aylien.com/api/v1/summarize?url=" + url, true);
      xhttp.send();
    }
      
      
      xhttp.onreadystatechange = function() {
        
        if (this.readyState == 4 && this.status == 200) {
          var headline, category, date, bodyText;
          var sentences;
          var resp = JSON.parse(this.responseText);
          var count = resp.response.results.length;
          var news = document.getElementById("news");
    
          console.log(resp.response.results[0]);
          for(var i = 0; i < count; i++) {
            
            headline = resp.response.results[i].webTitle;
            category = resp.response.results[i].sectionName;
            date = resp.response.results[i].webPublicationDate;
            url = resp.response.results[i].webUrl;
            bodyText = resp.response.results[i].fields.bodyText;
            textSummarize(url, function(response) {
              
              var article = document.createElement("div");
              var lineBreak = document.createElement("br");
              var sentences = response;
              var h = document.createElement("p");
              var c = document.createElement("p");
              var d = document.createElement("p");
              var url = document.createElement("p");
              var b = document.createElement("ul");

              h.setAttribute("class", "headline");
              c.setAttribute("class", "category");
              d.setAttribute("class", "date");
              b.setAttribute("class", "sentences")

              h.innerHTML = headline;
              c.innerHTML = category;
              d.innerHTML = new Date(date).toUTCString();

              news.appendChild(article); 
              article.appendChild(h);
              article.appendChild(c);
              article.appendChild(d);
              article.appendChild(b);
              for(var n = 0; n < sentences.length; n++) {
                var s = document.createElement("li");
                s.innerHTML = sentences[n];
                b.appendChild(s);
              }
              article.appendChild(lineBreak);
            });
          }

          }
        }
      
      xhttp.open("GET", "http://content.guardianapis.com/search?show-fields=bodyText&api-key=fe308324-ad4f-4317-a3df-7329ed2b238b", true);
      xhttp.send();
    }
    </script>
  
</head>
<body onload="loadXMLDoc()">

  <h1 id="header">See the latest news!</h1>
  <div class="news">
    <p class="headline"></p>
  </div>
  <script src="test/featureTest.js" type="text/javascript"></script>
 
  
  
</body>
</html>

